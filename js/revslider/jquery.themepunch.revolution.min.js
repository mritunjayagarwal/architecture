/* Revolution Slider Main JavaScript */

(function($) {
    'use strict';
    
    // Revolution Slider Main
    window.RevSlider = {
        
        // Initialize all sliders
        init: function() {
            $('.js-rev').each(function() {
                var slider = $(this);
                var settings = slider.data('settings') || {};
                
                // Default settings
                var defaultSettings = {
                    autoplay: true,
                    delay: 5000,
                    transition: 'crossfade',
                    navigation: {
                        arrows: true,
                        bullets: true,
                        thumbs: false
                    },
                    layout: 'fullscreen'
                };
                
                // Merge settings
                var finalSettings = $.extend({}, defaultSettings, settings);
                
                // Initialize slider
                RevSlider.initSlider(slider, finalSettings);
            });
        },
        
        // Initialize individual slider
        initSlider: function(slider, settings) {
            var self = this;
            
            // Setup slider container
            slider.addClass('rev-slider-initialized');
            
            // Get slides
            var slides = slider.find('.rev-item');
            var totalSlides = slides.length;
            
            if (totalSlides === 0) return;
            
            // Setup slides
            slides.each(function(index) {
                var slide = $(this);
                var transition = slide.data('transition') || settings.transition;
                
                slide.css({
                    'position': 'absolute',
                    'top': 0,
                    'left': 0,
                    'width': '100%',
                    'height': '100%',
                    'opacity': index === 0 ? 1 : 0,
                    'z-index': totalSlides - index
                });
                
                slide.addClass('transition-' + transition);
            });
            
            // Setup navigation
            if (settings.navigation.arrows) {
                self.addArrowNavigation(slider);
            }
            
            if (settings.navigation.bullets) {
                self.addBulletNavigation(slider, totalSlides);
            }
            
            if (settings.navigation.thumbs) {
                self.addThumbnailNavigation(slider, totalSlides);
            }
            
            // Setup autoplay
            if (settings.autoplay) {
                self.setupAutoplay(slider, settings.delay);
            }
            
            // Setup keyboard navigation
            self.setupKeyboardNavigation(slider);
            
            // Setup touch/swipe navigation
            self.setupTouchNavigation(slider);
        },
        
        // Add arrow navigation
        addArrowNavigation: function(slider) {
            var arrowsHtml = '<div class="tp-leftarrow"></div><div class="tp-rightarrow"></div>';
            slider.append(arrowsHtml);
            
            var self = this;
            slider.find('.tp-leftarrow').on('click', function() {
                self.previousSlide(slider);
            });
            
            slider.find('.tp-rightarrow').on('click', function() {
                self.nextSlide(slider);
            });
        },
        
        // Add bullet navigation
        addBulletNavigation: function(slider, totalSlides) {
            var bulletsHtml = '<div class="tp-bullets">';
            for (var i = 0; i < totalSlides; i++) {
                bulletsHtml += '<div class="tp-bullet' + (i === 0 ? ' selected' : '') + '"></div>';
            }
            bulletsHtml += '</div>';
            
            slider.append(bulletsHtml);
            
            var self = this;
            slider.find('.tp-bullet').on('click', function() {
                var index = $(this).index();
                self.goToSlide(slider, index);
            });
        },
        
        // Add thumbnail navigation
        addThumbnailNavigation: function(slider, totalSlides) {
            var thumbsHtml = '<div class="tp-thumbs">';
            slider.find('.rev-item').each(function(index) {
                var imgSrc = $(this).find('.rev-slidebg').attr('src');
                thumbsHtml += '<div class="tp-thumb' + (index === 0 ? ' selected' : '') + '"><img src="' + imgSrc + '" alt=""></div>';
            });
            thumbsHtml += '</div>';
            
            slider.append(thumbsHtml);
            
            var self = this;
            slider.find('.tp-thumb').on('click', function() {
                var index = $(this).index();
                self.goToSlide(slider, index);
            });
        },
        
        // Setup autoplay
        setupAutoplay: function(slider, delay) {
            var self = this;
            var autoplayTimer;
            
            function startAutoplay() {
                autoplayTimer = setInterval(function() {
                    self.nextSlide(slider);
                }, delay);
            }
            
            function stopAutoplay() {
                if (autoplayTimer) {
                    clearInterval(autoplayTimer);
                    autoplayTimer = null;
                }
            }
            
            // Start autoplay
            startAutoplay();
            
            // Pause on hover
            slider.on('mouseenter', stopAutoplay).on('mouseleave', startAutoplay);
            
            // Store functions for external control
            slider.data('startAutoplay', startAutoplay);
            slider.data('stopAutoplay', stopAutoplay);
        },
        
        // Setup keyboard navigation
        setupKeyboardNavigation: function(slider) {
            var self = this;
            
            $(document).on('keydown.revslider', function(e) {
                if (slider.is(':visible')) {
                    if (e.keyCode === 37) { // Left arrow
                        self.previousSlide(slider);
                    } else if (e.keyCode === 39) { // Right arrow
                        self.nextSlide(slider);
                    }
                }
            });
        },
        
        // Setup touch navigation
        setupTouchNavigation: function(slider) {
            var self = this;
            var startX = 0;
            var startY = 0;
            var endX = 0;
            var endY = 0;
            
            slider.on('touchstart', function(e) {
                var touch = e.originalEvent.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
            });
            
            slider.on('touchend', function(e) {
                var touch = e.originalEvent.changedTouches[0];
                endX = touch.clientX;
                endY = touch.clientY;
                
                var diffX = startX - endX;
                var diffY = startY - endY;
                
                // Only trigger if horizontal swipe is greater than vertical
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    if (diffX > 0) {
                        self.nextSlide(slider);
                    } else {
                        self.previousSlide(slider);
                    }
                }
            });
        },
        
        // Go to specific slide
        goToSlide: function(slider, index) {
            var slides = slider.find('.rev-item');
            var totalSlides = slides.length;
            
            if (index < 0 || index >= totalSlides) return;
            
            var currentSlide = slides.filter('.active').first();
            var nextSlide = slides.eq(index);
            
            // Remove active class
            slides.removeClass('active');
            
            // Add active class to next slide
            nextSlide.addClass('active');
            
            // Animate transition
            this.animateTransition(currentSlide, nextSlide);
            
            // Update navigation
            this.updateNavigation(slider, index);
            
            // Stop and restart autoplay
            var stopAutoplay = slider.data('stopAutoplay');
            var startAutoplay = slider.data('startAutoplay');
            
            if (stopAutoplay && startAutoplay) {
                stopAutoplay();
                setTimeout(startAutoplay, 100);
            }
        },
        
        // Next slide
        nextSlide: function(slider) {
            var currentIndex = slider.find('.rev-item.active').index();
            var nextIndex = (currentIndex + 1) % slider.find('.rev-item').length;
            this.goToSlide(slider, nextIndex);
        },
        
        // Previous slide
        previousSlide: function(slider) {
            var currentIndex = slider.find('.rev-item.active').index();
            var prevIndex = (currentIndex - 1 + slider.find('.rev-item').length) % slider.find('.rev-item').length;
            this.goToSlide(slider, prevIndex);
        },
        
        // Animate transition
        animateTransition: function(currentSlide, nextSlide) {
            var transition = nextSlide.data('transition') || 'crossfade';
            
            switch (transition) {
                case 'crossfade':
                    currentSlide.css('opacity', 0);
                    nextSlide.css('opacity', 1);
                    break;
                case 'slideleft':
                    currentSlide.css('transform', 'translateX(-100%)');
                    nextSlide.css('transform', 'translateX(0)');
                    break;
                case 'slideright':
                    currentSlide.css('transform', 'translateX(100%)');
                    nextSlide.css('transform', 'translateX(0)');
                    break;
                case 'slideup':
                    currentSlide.css('transform', 'translateY(-100%)');
                    nextSlide.css('transform', 'translateY(0)');
                    break;
                case 'slidedown':
                    currentSlide.css('transform', 'translateY(100%)');
                    nextSlide.css('transform', 'translateY(0)');
                    break;
                default:
                    currentSlide.css('opacity', 0);
                    nextSlide.css('opacity', 1);
            }
        },
        
        // Update navigation
        updateNavigation: function(slider, index) {
            // Update bullets
            slider.find('.tp-bullet').removeClass('selected');
            slider.find('.tp-bullet').eq(index).addClass('selected');
            
            // Update thumbnails
            slider.find('.tp-thumb').removeClass('selected');
            slider.find('.tp-thumb').eq(index).addClass('selected');
        }
    };
    
    // Initialize on document ready
    $(document).ready(function() {
        RevSlider.init();
    });
    
})(jQuery);

